
{% extends 'dashboard_base.html' %}

{% block content %}
{% load expiry_extras %}

<div class="relative bg-gradient-to-br from-green-400 to-green-600 -m-8 mb-0 p-8 pb-6 md:rounded-2xl dark:shadow-black/30 dark:from-green-600 dark:to-green-800">
    <div class="flex justify-between items-center">
        <button 
            class="glass rounded-xl px-6 py-3 flex items-center gap-3 shadow-2xl transition-all duration-300 ease-out hover:shadow-xl hover:-translate-y-0.5 active:translate-y-0"
            onclick="history.back()" 
        >
            <span class="material-symbols-outlined">arrow_back</span>
        </button>
        <h1 class="text-white text-3xl md:text-4xl md:font-bold">Profile</h1>
        <div class="w-13.5 h-13.5"></div>
    </div>
</div>


<!-- two forms, one for first, last and username -->
<!-- and another for changing password -->
<div>
    <div class="w-full flex flex-col items-center justify-center px-6 pt-12 pb-8 md:p-6 shadow-lg bg-white rounded-t-3xl md:rounded-3xl">
        <!-- icon -->
         <div class="w-32 h-32 rounded-full overflow-hidden">
            <img src="your-image-url.jpg" alt="Profile Picture" class="w-full h-full bg-gray-600 object-cover justify-center">
        </div>
        <!-- name -->
        {% if details_form.username %}
            {{ details_form.username }}
        {% else %}
            Username
        {%endif%}


        <!-- details form -->
        <form class="space-y-6 md:space-y-4 max-w-md mx-auto md:max-w-none" method="post">
            {% csrf_token %}

            <div class="flex flex-col gap-6 md:gap-4">
                {% for field in details_form %}
                    <div class="rounded-xl px-6 py-3 flex items-center justify-between gap-3 shadow-xl
                    hover:-translate-y-0.5 transition dark:bg-gray-700 dark:border-gray-600 dark:text-white ">
                        {{ field }}

                        {% if field.errors %}
                        <p class="text-red-500 text-sm">
                            {{ field.errors|striptags }}
                        </p>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
            <div class="flex items-center justify-center mt-6 md:mt-4">
                <button 
                    class="w-full font-semibold glass text-white bg-gradient-to-br from-green-400 to-green-600 rounded-xl px-6 py-4 md:py-3 flex items-center justify-center gap-3 shadow-2xl transition-all duration-300 ease-out hover:shadow-xl hover:-translate-y-0.5 active:translate-y-0"
                >Save Profile</button>
            </div>

        </form>
         <!-- passwords form -->
        <form class="space-y-6 md:space-y-4 max-w-md mx-auto md:max-w-none" method="post">
            {% csrf_token %}

            <div class="flex flex-col gap-6 md:gap-4">
                {% for field in password_form %}
                    <div class="rounded-xl px-6 py-3 flex items-center justify-between gap-3 shadow-xl
                    hover:-translate-y-0.5 transition dark:bg-gray-700 dark:border-gray-600 dark:text-white ">
                        {{ field }}

                        {% if field.errors %}
                        <p class="text-red-500 text-sm">
                            {{ field.errors|striptags }}
                        </p>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
            <div class="flex items-center justify-center mt-6 md:mt-4">
                <button 
                    class="w-full font-semibold glass text-white bg-gradient-to-br from-green-400 to-green-600 rounded-xl px-6 py-4 md:py-3 flex items-center justify-center gap-3 shadow-2xl transition-all duration-300 ease-out hover:shadow-xl hover:-translate-y-0.5 active:translate-y-0"
                >Change Password</button>
            </div>
            
        </form>
    </div>
</div>




<script>
    document.querySelectorAll('.undo-button').forEach(button => {
        button.addEventListener('click', async function() {
            const itemId = this.dataset.itemId;
            const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
            
            try {
                const response = await fetch(`/items/${itemId}/edit/`, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': csrfToken,
                    },
                    body: new URLSearchParams({
                        action: 'undo',
                    }),
                });
                
                if (response.ok) {
                    // Remove the item from the list or reload
                    this.closest('li').remove();
                    // Or reload the page: location.reload();
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Failed to undo deletion');
            }
        });
    });
    window.addEventListener('pageshow', (event) => {
        if (event.persisted) {
            location.reload(); // only reload if the page came from cache
        }
    });

</script>


{% endblock %}